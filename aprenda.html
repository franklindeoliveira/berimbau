<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berimbau Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <style>
        button {
            width: 50px;
            height: 50px;
        }
        .toque_batidas {
            width: 500px;
        }
        .playlist li {
            border: 1px solid #ffffff;
        }
        .playlist li:hover {
            border: 1px solid #acacac;
        }
    </style>
     <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
     <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
     <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="player.css">
    <link rel="stylesheet" href="playlist.css">
    <!--=============== BOXICONS ===============-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <script src="player.js"></script>
</head>
<body>
    <header class="header" id="header">
        <nav class="nav container">
            <a href="#" class="nav__logo">Marlon</a>

            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                    <li class="nav__item">
                        <a href="index.html" class="nav__link">
                            <i class='bx bx-music nav__icon'></i>
                            <span class="nav__name">Toques</span>
                        </a>
                    </li>
                    
                    <li class="nav__item">
                        <a href="aprenda.html" class="nav__link active-link">
                            <i class='bx bx-user nav__icon'></i>
                            <span class="nav__name">Aprenda</span>
                        </a>
                    </li>

                    <li class="nav__item">
                        <a href="mestres.html" class="nav__link">
                            <i class='bx bx-book-alt nav__icon'></i>
                            <span class="nav__name">Mestres</span>
                        </a>
                    </li>

                    <li class="nav__item">
                        <a href="#portfolio" class="nav__link">
                            <i class='bx bx-briefcase-alt nav__icon'></i>
                            <span class="nav__name">Compartilhe</span>
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="compor.html" class="nav__link">
                            <i class='bx bx-equalizer nav__icon'></i>
                            <span class="nav__name">Componha</span>
                        </a>
                    </li>
                </ul>
            </div>

            <img src="assets/img/perfil.png" alt="" class="nav__img">
        </nav>
    </header>
    
    <h1>Toques de Berimbau</h1>

    <div class="container">
        <section class="implementation">
            <div class="visor">teste</div>
            <div class="now-playing-board" id="now-playing-board-id">
                <div class="now-playing-details">
                    <h4>Toque de Angola</h4>
                    <h6 style="color:rgb(71,71,71);">Capoeira</h6>
                    <div class="slidecontainer-one">
                        <input type="range" min="1" max="100" value="1" class="slider" id="range">
                        <div id="completionBar"></div>
                    </div>
                </div>
            </div>
            <div class="now-playing-board-bottom-bar" id="now-playing-board-bottom-bar-id">
            </div>            
            <div class="play-controls">
                <img src="https://pngimg.com/uploads/vinyl/vinyl_PNG21.png" width=100 height=100 id="vynl-id"
                    class="vynl" />
                <div class="play-buttons">
                    <i class='fa fa-step-backward' style='font-size:20px'></i>
                    <div class='play-circle' id="playpause" onclick="play(this)"></div>
                    <i class='fa fa-step-forward' style='font-size:20px'></i>
                </div>
    
                <div class="volume-button">
                    <i class='fa fa-volume-up' style='font-size:15px'></i>
                </div>
            </div>
            <audio id="audioSrc">
                <source src="https://www.cjoint.com/doc/21_06/KFibDJfanp7_Queen---Radio-Ga-Ga-Official-Video-.mp3">
            </audio>
            <div class="player">
                <div class="music">
                    <div class="song-3">
                        <div class="info">
                            <div class="img third"></div>
                            <div class="titles">
                                <h5>Toque São Bento Grande de Angola</h5>
                                <p>Capoeira</p>
                            </div>
                        </div>
                        <div class="state">
                            <i class="material-icons">play_arrow</i>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
    </div>
    
    <p>Toque nas batidas abaixo para ouvir os sons.</p>

    <h2>Batidas (notas)</h2>
    <ul>
        <li><button data-toque="dom">&#128901;</button> dom - Batida com o Dobrão <em>desencostado</em> do Arame</li>
        <li><button data-toque="dim">&#11044;</button> dim - Batida com o Dobrão <em>fortemente</em> encostada no Arame</li>
        <li><button data-toque="tchi">&#10761;</button> tchi - Batida com o Dobrão <em>levemente</em> encostada no Arame</li>
        <li><button data-toque="domchi">&#8855;</button> domchi - Batida "arranhando" o Dobrão no Arame</li>
    </ul>

    <script>
        let velocidade = 1
        let idsReproducao = [];

        document.querySelector("#velocidade").textContent = velocidade + "x"

        document.querySelectorAll("[data-toque]").forEach(toque => {
            let audio = new Audio(`audio/${toque.dataset.toque}.mp3`)
            audio.autoPlay = false
            toque.addEventListener("click", function(event) {
                if (event.target.dataset.toque == "dom") {
                    tocarDom()
                }
                if (event.target.dataset.toque == "tchi") {
                    tocarTchi()
                }
                if (event.target.dataset.toque == "dim") {
                    tocarDim()
                }
                if (event.target.dataset.toque == "domchi") {
                    tocarDomChi()
                }
                event.target.value = ""
            })
        })

        

        document.querySelector("#toque_personalizado").addEventListener("click", () => tocar(document.querySelector("#toque_personalizado_batidas").value))
        document.querySelector("#toque_angola").addEventListener("click", () => tocar(document.querySelector("#toque_angola_batidas").value))
        document.querySelector("#toque_sbp").addEventListener("click", () => tocar(document.querySelector("#toque_sbp_batidas").value))
        document.querySelector("#toque_sbg").addEventListener("click", () => tocar(document.querySelector("#toque_sbg_batidas").value))
        document.querySelector("#toque_angola2").addEventListener("click", () => tocar(document.querySelector("#toque_angola_batidas").value))
        document.querySelector("#toque_sbp2").addEventListener("click", () => tocar(document.querySelector("#toque_sbp_batidas").value))
        document.querySelector("#toque_sbg2").addEventListener("click", () => tocar(document.querySelector("#toque_sbg_batidas").value))
        document.querySelector("#parar").addEventListener("click", parar)
        document.querySelectorAll(".parar").forEach(pararAudio => pararAudio.addEventListener("click", parar))

        function tocar(batidas) {
            
            let batidasPartes = batidas.split(" ")

            let batidasValidas = true;
            let msgValidacao = "";
            batidasPartes.forEach(batida => {
                if (batida != "dom" && batida != "dim" && batida != "tchi" && batida != "domchi" && !batida.includes("s")) {
                    batidasValidas = false;
                    msgValidacao += "Simbolo '" + batida + "'' invalido. "
                }
            })

            if (!batidasValidas) {
                alert(msgValidacao)
                return
            }
            
            let timeout = 0
            let batidaParteIntervalo = 1
            batidasPartes.forEach(batidaParte => {
                if (batidaParte.includes("s")) {
                    batidaParteIntervalo = Number(batidaParte.replace("s", ""))                    
                } else {
                    batidaParteIntervalo = 1
                }

                timeout += batidaParteIntervalo * 1000 / velocidade
                
                if (batidaParte == "dom") {
                    idsReproducao.push(setTimeout(tocarDom, timeout))
                    batidaParteIntervalo = 1
                } else if (batidaParte == "tchi") {
                    idsReproducao.push(setTimeout(tocarTchi, timeout))
                    batidaParteIntervalo = 1
                } else if (batidaParte == "dim") {
                    idsReproducao.push(setTimeout(tocarDim, timeout))
                    batidaParteIntervalo = 1
                } else if (batidaParte == "domchi") {
                    idsReproducao.push(setTimeout(tocarDomChi, timeout))
                    batidaParteIntervalo = 1
                }
            })
            if (document.querySelector("#repetir").checked) {
                idsReproducao.push(setTimeout(() => tocar(batidas), timeout))
            }            
        }

        function parar() {
            idsReproducao.forEach(idReproducao => {
                clearTimeout(idReproducao)
            })
            idsReproducao = []
        }
        
        document.querySelector("#velocidade_mais").addEventListener("click", async function(event) {
            velocidade += 0.25
            document.querySelector("#velocidade").textContent = velocidade + "x"
        })

        document.querySelector("#velocidade_menos").addEventListener("click", async function(event) {
            velocidade -= 0.25
            document.querySelector("#velocidade").textContent = velocidade + "x"
        })

        function tocarTchi() {
            new Audio("audio/tchi.mp3").play()
        }

        function tocarDomChi() {
            new Audio("audio/domchi.mp3").play()
        }

        function tocarDim() {
            new Audio("audio/dim.mp3").play()
        }

        function tocarDom() {
            new Audio("audio/dom.mp3").play()
        }
    </script>
    <script src="assets/js/main.js"></script>
</body>
</html>